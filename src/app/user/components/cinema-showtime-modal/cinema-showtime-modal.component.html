<div class="modal" *ngIf="showModal">
  <div class="modal-content" #modalContent>
    <h2 class="modal-title">Chọn rạp và suất chiếu - {{ movie?.title }}</h2>
    <span class="close" (click)="closeModal()">×</span>
    <hr />
    <div class="cinema-filter">
      <div class="filter-item">
        <label for="city-select">Chọn thành phố:</label>
        <select id="city-select" [(ngModel)]="selectedCity" (change)="selectCity(selectedCity)">
          <option [ngValue]="null" disabled>Chọn thành phố</option>
          <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
        </select>
      </div>
      <div class="filter-item">
        <label for="cinema-select">Chọn rạp:</label>
        <select
          id="cinema-select"
          [(ngModel)]="selectedCinema"
          (change)="selectCinema(selectedCinema)"
          [disabled]="!selectedCity"
        >
          <option [ngValue]="null" disabled>Chọn rạp</option>
          <option *ngFor="let cinema of cinemasInCity" [value]="cinema.id">
            {{ cinema.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="date-filter">
      <button
        *ngFor="let date of availableDates"
        [class.active]="selectedDate === date"
        (click)="selectDate(date)"
      >
        {{ date | date: 'dd/MM/yyyy' }}
      </button>
    </div>
    <div class="cinema-showtimes" *ngFor="let cinema of filteredShowtimes">
      <h4>{{ cinema.cinemaName }}</h4>
      <div class="showtime-list">
        <button
          *ngFor="let showtime of cinema.showtimes"
          class="showtime-btn"
          (click)="selectShowtime(cinema, showtime)"
          [ngClass]="{ active: selectedShowtime === showtime }"
        >
          {{ formatTime(showtime.startTime) }}
        </button>
      </div>
    </div>
    <p *ngIf="!filteredShowtimes?.length && selectedCity && selectedCinema && selectedDate">
      Không có suất chiếu nào vào ngày này tại rạp này.
    </p>
    <div class="modal-actions">
      <button
        class="btn btn-primary"
        (click)="proceedToConfirm()"
        [disabled]="!selectedCinema || !selectedShowtime"
      >
        Tiếp tục
      </button>
      <button class="btn btn-secondary" (click)="closeModal()">Hủy</button>
    </div>
  </div>
</div>
